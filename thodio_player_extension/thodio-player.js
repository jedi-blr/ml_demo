define(function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=7)}([function(t,e,r){var i;void 0===(i=function(t,e,i){var n=r(8),a=r(4),s="undefined"!=typeof Float64Array;function o(t,e){return t[0]-e[0]}function h(){var t,e=this.stride,r=new Array(e.length);for(t=0;t<r.length;++t)r[t]=[Math.abs(e[t]),t];r.sort(o);var i=new Array(r.length);for(t=0;t<i.length;++t)i[t]=r[t][1];return i}function l(t,e){var r=["View",e,"d",t].join("");e<0&&(r="View_Nil"+t);var i="generic"===t;if(-1===e){var a="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(a)()}if(0===e){a="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";return new Function("TrivialArray",a)(u[t][0])}a=["'use strict'"];var s=n(e),o=s.map(function(t){return"i"+t}),l="this.offset+"+s.map(function(t){return"this.stride["+t+"]*i"+t}).join("+"),c=s.map(function(t){return"b"+t}).join(","),f=s.map(function(t){return"c"+t}).join(",");a.push("function "+r+"(a,"+c+","+f+",d){this.data=a","this.shape=["+c+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),a.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+s.map(function(t){return"this.shape["+t+"]"}).join("*"),"}})"),1===e?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),e<4?(a.push("function "+r+"_order(){"),2===e?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):a.push("ORDER})")),a.push("proto.set=function "+r+"_set("+o.join(",")+",v){"),i?a.push("return this.data.set("+l+",v)}"):a.push("return this.data["+l+"]=v}"),a.push("proto.get=function "+r+"_get("+o.join(",")+"){"),i?a.push("return this.data.get("+l+")}"):a.push("return this.data["+l+"]}"),a.push("proto.index=function "+r+"_index(",o.join(),"){return "+l+"}"),a.push("proto.hi=function "+r+"_hi("+o.join(",")+"){return new "+r+"(this.data,"+s.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")}).join(",")+","+s.map(function(t){return"this.stride["+t+"]"}).join(",")+",this.offset)}");var d=s.map(function(t){return"a"+t+"=this.shape["+t+"]"}),p=s.map(function(t){return"c"+t+"=this.stride["+t+"]"});a.push("proto.lo=function "+r+"_lo("+o.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+p.join(","));for(var g=0;g<e;++g)a.push("if(typeof i"+g+"==='number'&&i"+g+">=0){d=i"+g+"|0;b+=c"+g+"*d;a"+g+"-=d}");a.push("return new "+r+"(this.data,"+s.map(function(t){return"a"+t}).join(",")+","+s.map(function(t){return"c"+t}).join(",")+",b)}"),a.push("proto.step=function "+r+"_step("+o.join(",")+"){var "+s.map(function(t){return"a"+t+"=this.shape["+t+"]"}).join(",")+","+s.map(function(t){return"b"+t+"=this.stride["+t+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(g=0;g<e;++g)a.push("if(typeof i"+g+"==='number'){d=i"+g+"|0;if(d<0){c+=b"+g+"*(a"+g+"-1);a"+g+"=ceil(-a"+g+"/d)}else{a"+g+"=ceil(a"+g+"/d)}b"+g+"*=d}");a.push("return new "+r+"(this.data,"+s.map(function(t){return"a"+t}).join(",")+","+s.map(function(t){return"b"+t}).join(",")+",c)}");var y=new Array(e),v=new Array(e);for(g=0;g<e;++g)y[g]="a[i"+g+"]",v[g]="b[i"+g+"]";a.push("proto.transpose=function "+r+"_transpose("+o+"){"+o.map(function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+y.join(",")+","+v.join(",")+",this.offset)}"),a.push("proto.pick=function "+r+"_pick("+o+"){var a=[],b=[],c=this.offset");for(g=0;g<e;++g)a.push("if(typeof i"+g+"==='number'&&i"+g+">=0){c=(c+this.stride["+g+"]*i"+g+")|0}else{a.push(this.shape["+g+"]);b.push(this.stride["+g+"])}");return a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+s.map(function(t){return"shape["+t+"]"}).join(",")+","+s.map(function(t){return"stride["+t+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",a.join("\n"))(u[t],h)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};i.exports=function(t,e,r,i){if(void 0===t)return(0,u.array[0])([]);"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var n=e.length;if(void 0===r){r=new Array(n);for(var o=n-1,h=1;o>=0;--o)r[o]=h,h*=e[o]}if(void 0===i)for(i=0,o=0;o<n;++o)r[o]<0&&(i-=(e[o]-1)*r[o]);for(var c=function(t){if(a(t))return"buffer";if(s)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(t)?"array":"generic"}(t),f=u[c];f.length<=n+1;)f.push(l(c,f.length-1));return(0,f[n+1])(t,e,r,i)}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){(function(i){var n;void 0===(n=function(t,e,n){"use strict";var a=r(2),s=r(21),o=r(4),h={UINT8:s([32,0]),UINT16:s([32,0]),UINT32:s([32,0]),INT8:s([32,0]),INT16:s([32,0]),INT32:s([32,0]),FLOAT:s([32,0]),DOUBLE:s([32,0]),DATA:s([32,0]),UINT8C:s([32,0]),BUFFER:s([32,0])},l="undefined"!=typeof Uint8ClampedArray,u=h;u.UINT8C||(u.UINT8C=s([32,0])),u.BUFFER||(u.BUFFER=s([32,0]));var c=u.DATA,f=u.BUFFER;function d(t){if(t){var e=t.length||t.byteLength,r=a.log2(e);c[r].push(t)}}function p(t){t=a.nextPow2(t);var e=a.log2(t),r=c[e];return r.length>0?r.pop():new ArrayBuffer(t)}function g(t){return new Uint8Array(p(t),0,t)}function y(t){return new Uint16Array(p(2*t),0,t)}function v(t){return new Uint32Array(p(4*t),0,t)}function m(t){return new Int8Array(p(t),0,t)}function b(t){return new Int16Array(p(2*t),0,t)}function w(t){return new Int32Array(p(4*t),0,t)}function _(t){return new Float32Array(p(4*t),0,t)}function x(t){return new Float64Array(p(8*t),0,t)}function k(t){return l?new Uint8ClampedArray(p(t),0,t):g(t)}function A(t){return new DataView(p(t),0,t)}function E(t){t=a.nextPow2(t);var e=a.log2(t),r=f[e];return r.length>0?r.pop():new i(t)}e.free=function(t){if(o(t))f[a.log2(t.length)].push(t);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(t)&&(t=t.buffer),!t)return;var e=t.length||t.byteLength,r=0|a.log2(e);c[r].push(t)}},e.freeUint8=e.freeUint16=e.freeUint32=e.freeInt8=e.freeInt16=e.freeInt32=e.freeFloat32=e.freeFloat=e.freeFloat64=e.freeDouble=e.freeUint8Clamped=e.freeDataView=function(t){d(t.buffer)},e.freeArrayBuffer=d,e.freeBuffer=function(t){f[a.log2(t.length)].push(t)},e.malloc=function(t,e){if(void 0===e||"arraybuffer"===e)return p(t);switch(e){case"uint8":return g(t);case"uint16":return y(t);case"uint32":return v(t);case"int8":return m(t);case"int16":return b(t);case"int32":return w(t);case"float":case"float32":return _(t);case"double":case"float64":return x(t);case"uint8_clamped":return k(t);case"buffer":return E(t);case"data":case"dataview":return A(t);default:return null}return null},e.mallocArrayBuffer=p,e.mallocUint8=g,e.mallocUint16=y,e.mallocUint32=v,e.mallocInt8=m,e.mallocInt16=b,e.mallocInt32=w,e.mallocFloat32=e.mallocFloat=_,e.mallocFloat64=e.mallocDouble=x,e.mallocUint8Clamped=k,e.mallocDataView=A,e.mallocBuffer=E,e.clearCache=function(){for(var t=0;t<32;++t)u.UINT8[t].length=0,u.UINT16[t].length=0,u.UINT32[t].length=0,u.INT8[t].length=0,u.INT16[t].length=0,u.INT32[t].length=0,u.FLOAT[t].length=0,u.DOUBLE[t].length=0,u.UINT8C[t].length=0,c[t].length=0,f[t].length=0}}.call(e,r,e,t))||(t.exports=n)}).call(this,r(16).Buffer)},function(t,e,r){var i;void 0===(i=function(t,e,r){"use strict";function i(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}e.INT_BITS=32,e.INT_MAX=2147483647,e.INT_MIN=-1<<31,e.sign=function(t){return(t>0)-(t<0)},e.abs=function(t){var e=t>>31;return(t^e)-e},e.min=function(t,e){return e^(t^e)&-(t<e)},e.max=function(t,e){return t^(t^e)&-(t<e)},e.isPow2=function(t){return!(t&t-1||!t)},e.log2=function(t){var e,r;return e=(t>65535)<<4,e|=r=((t>>>=e)>255)<<3,e|=r=((t>>>=r)>15)<<2,(e|=r=((t>>>=r)>3)<<1)|(t>>>=r)>>1},e.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},e.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},e.countTrailingZeros=i,e.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},e.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},e.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var n=new Array(256);!function(t){for(var e=0;e<256;++e){var r=e,i=e,n=7;for(r>>>=1;r;r>>>=1)i<<=1,i|=1&r,--n;t[e]=i<<n&255}}(n),e.reverse=function(t){return n[255&t]<<24|n[t>>>8&255]<<16|n[t>>>16&255]<<8|n[t>>>24&255]},e.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},e.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},e.interleave3=function(t,e,r){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<2},e.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},e.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>i(t)+1}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){"use strict";i.exports=function(t){var e,r,i;if(Array.isArray(t)){if(0===(e=t.length))return new d(null,null,0,0);r=t[0].length,i=n(l.mallocDouble(e*(r+1)),[e,r+1]),s(t,i.hi(e,r))}else{e=t.shape[0],r=t.shape[1];var f=t.dtype;f="int8"===f||"int16"===f||"int32"===f?"int32":"uint8"===f||"uint8_clamped"===f||"buffer"===f||"uint16"===f||"uint32"===f?"uint32":"float32"===f?"float32":"float64",i=n(l.malloc(e*(r+1)),[e,r+1]),o.assign(i.hi(e,r),t)}for(var p=0;p<e;++p)i.set(p,r,p);var g=h.malloc([e,r],t.dtype),y=l.mallocInt32(e),v=0,m=g.data,b=i.data,w=(c.log2(c.nextPow2(e)),a.compile(i.order,!0,i.dtype)),_=[i];for(;v<e;){var x=_.shift(),k=x,A=0|k.shape[0];if(A>1){var E,S=c.log2(v+1)%r,I=u.root(A);E=w(k,I,function(t,e){return t.get(S)-e.get(S)});for(var P=g.index(v,0),T=E.offset,p=0;p<r;++p)m[P++]=b[T++];y[v]=b[T],v+=1,_.push(k.hi(I)),A>2&&_.push(k.lo(I+1))}else{for(var T=k.offset,P=g.index(v,0),p=0;p<r;++p)m[P+p]=b[T++];y[v]=b[T],v+=1}}return l.free(i.data),new d(g,y,e,r)},i.exports.deserialize=function(t){var e=t.p,r=t.i;if(e){for(var i=e.length,a=l.mallocFloat64(i),s=0;s<i;++s)a[s]=e[s];for(var o=r.length,h=l.mallocInt32(o),s=0;s<o;++s)h[s]=r[s];var u=i/o|0;return new d(n(a,[o,u]),h,o,u)}return new d(null,null,0,t.d)};var n=r(0),a=r(9),s=r(10),o=r(6),h=r(15),l=r(1),u=r(22),c=r(2),f=r(23);function d(t,e,r,i){this.points=t,this.ids=e,this.dimension=i,this.length=r}var p=d.prototype;p.serialize=function(){return this.length>0?{p:Array.prototype.slice.call(this.points.data,0,this.length*this.dimension),i:Array.prototype.slice.call(this.ids,0,this.length)}:{d:this.dimension}},p.range=function(t,e,r){var i=this.length;if(!(i<1)){for(var n=this.dimension,a=0;a<n;++a)if(e[a]<t[a])return;var o,u=this.points,f=this.ids,d=h.malloc([i,2,n]),p=l.mallocInt32(i),g=d.data,y=u.data,v=1,m=0;for(p[0]=0,s(t,d.pick(0,0)),s(e,d.pick(0,1));m<v;){var b=p[m],w=c.log2(b+1)%n,_=d.index(m,0,0),x=d.index(m,1,0),k=u.index(b,0),A=!0;for(a=0;a<n;++a){var E=y[k+a];if(E<g[_+a]||g[x+a]<E){A=!1;break}}if(A&&void 0!==(o=r(f[b])))break;var S=y[k+w],I=g[x+w],P=g[_+w];if(P<=S){var T=2*b+1;if(T<i){p[v]=T;var j=d.index(v,0,0);for(a=0;a<n;++a)g[j+a]=g[_+a];var R=d.index(v,1,0);for(a=0;a<n;++a)g[R+a]=g[x+a];g[R+w]=Math.min(I,S),v+=1}}if(S<=I){var B=2*(b+1);if(B<i){p[v]=B;for(j=d.index(v,0,0),a=0;a<n;++a)g[j+a]=g[_+a];for(R=d.index(v,1,0),a=0;a<n;++a)g[R+a]=g[x+a];g[j+w]=Math.max(P,S),v+=1}}m+=1}return h.free(d),l.free(p),o}},p.rnn=function(t,e,r){if(!(e<0)){var i=this.length;if(!(i<1)){var n,a=this.dimension,s=this.points,o=this.ids,u=h.malloc([i,a]),f=l.mallocInt32(i),d=u.data,p=s.data,g=1,y=0,v=e*e;f[0]=0;for(var m=0;m<a;++m)u.set(0,m,0);for(;y<g;){var b=f[y],w=s.index(b,0),_=0;for(m=0;m<a;++m)_+=Math.pow(t[m]-p[w+m],2);if(_<=v&&void 0!==(n=r(o[b])))break;var x=c.log2(b+1)%a,k=0,A=u.index(y,0);for(m=0;m<a;++m)m!==x&&(k+=d[A+m]);var E=t[x],S=p[w+x],I=d[A+x],P=I,T=I;E<S?T=Math.max(I,Math.pow(S-E,2)):P=Math.max(I,Math.pow(S-E,2));var j=T+k;if(P+k<=v){var R=2*b+1;if(R<i){f[g]=R;var B=u.index(g,0);for(m=0;m<a;++m)d[B+m]=d[A+m];d[B+x]=P,g+=1}}if(j<=v){var V=2*(b+1);if(V<i){f[g]=V;for(B=u.index(g,0),m=0;m<a;++m)d[B+m]=d[A+m];d[B+x]=T,g+=1}}y+=1}return h.free(u),l.free(f),n}}},p.nn=function(t,e){var r=this.length;if(r<1)return-1;if("number"==typeof e){if(e<0)return-1}else e=1/0;var i=this.dimension,n=this.points,a=n.data,s=l.mallocFloat64(i),o=new f(r,i+1),h=o.index,u=o.data;h[0]=0;for(var d=0;d<=i;++d)u[d]=0;o.count+=1;for(var p=-1,g=e;o.count>0&&!(u[0]>=g);){var y=h[0],v=n.index(y,0),m=0;for(d=0;d<i;++d)m+=Math.pow(t[d]-a[v+d],2);m<g&&(g=m,p=y);var b=c.log2(y+1)%i,w=0;for(d=0;d<i;++d){var _=u[d+1];d!==b&&(w+=_),s[d]=_}var x=t[b],k=a[v+b],A=s[b],E=A,S=A;x<k?S=Math.max(A,Math.pow(k-x,2)):E=Math.max(A,Math.pow(k-x,2));var I=E+w,P=S+w;if(o.pop(),I<g){var T=2*y+1;if(T<r){h[R=o.count]=T,u[B=R*(i+1)]=I;for(d=1;d<=i;++d)u[B+d]=s[d-1];u[B+b+1]=E,o.push()}}if(P<g){var j=2*(y+1);if(j<r){var R,B;h[R=o.count]=j,u[B=R*(i+1)]=P;for(d=1;d<=i;++d)u[B+d]=s[d-1];u[B+b+1]=S,o.push()}}}return l.freeFloat64(s),o.dispose(),p<0?-1:this.ids[p]},p.knn=function(t,e,r){if("number"==typeof r){if(r<0)return[]}else r=1/0;var i=this.length;if(i<1)return[];if("number"==typeof e){if(e<=0)return[];e=0|Math.min(e,i)}else e=i;var n=this.ids,a=this.dimension,s=this.points,o=s.data,h=l.mallocFloat64(a),u=new f(e,1),d=u.index,p=u.data,g=new f(i,a+1),y=g.index,v=g.data;y[0]=0;for(var m=0;m<=a;++m)v[m]=0;g.count+=1;for(var b=r;g.count>0&&!(v[0]>=b);){var w=y[0],_=s.index(w,0),x=0;for(m=0;m<a;++m)x+=Math.pow(t[m]-o[_+m],2);if(x<b){u.count>=e&&u.pop();var k=u.count;d[k]=w,p[k]=-x,u.push(),u.count>=e&&(b=-p[0])}var A=c.log2(w+1)%a,E=0;for(m=0;m<a;++m){var S=v[m+1];m!==A&&(E+=S),h[m]=S}var I=t[A],P=o[_+A],T=h[A],j=T,R=T;I<P?R=Math.max(T,Math.pow(P-I,2)):j=Math.max(T,Math.pow(P-I,2));var B=j+E,V=R+E;if(g.pop(),B<b){var C=2*w+1;if(C<i){y[U=g.count]=C,v[N=U*(a+1)]=B;for(m=1;m<=a;++m)v[N+m]=h[m-1];v[N+A+1]=j,g.push()}}if(V<b){var M=2*(w+1);if(M<i){var U,N;y[U=g.count]=M,v[N=U*(a+1)]=V;for(m=1;m<=a;++m)v[N+m]=h[m-1];v[N+A+1]=R,g.push()}}}l.freeFloat64(h),g.dispose();var O=new Array(u.count);for(n=this.ids,m=u.count-1;m>=0;--m)O[m]=n[d[0]],u.pop();return u.dispose(),O},p.dispose=function(){l.free(this.points.data),l.freeInt32(this.ids),this.points=null,this.ids=null,this.length=0}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,r){function i(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
r.exports=function(t){return null!=t&&(i(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&i(t.slice(0,0))}(t)||!!t._isBuffer)}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){"use strict";var n=r(12);function a(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}i.exports=function(t){var e=new a;e.pre=t.pre,e.body=t.body,e.post=t.post;var r=t.args.slice(0);e.argTypes=r;for(var i=0;i<r.length;++i){var s=r[i];if("array"===s||"object"==typeof s&&s.blockIndices){if(e.argTypes[i]="array",e.arrayArgs.push(i),e.arrayBlockIndices.push(s.blockIndices?s.blockIndices:0),e.shimArgs.push("array"+i),i<e.pre.args.length&&e.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array args");if(i<e.post.args.length&&e.post.args[i].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===s)e.scalarArgs.push(i),e.shimArgs.push("scalar"+i);else if("index"===s){if(e.indexArgs.push(i),i<e.pre.args.length&&e.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array index");if(i<e.body.args.length&&e.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array index");if(i<e.post.args.length&&e.post.args[i].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===s){if(e.shapeArgs.push(i),i<e.pre.args.length&&e.pre.args[i].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(i<e.body.args.length&&e.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array shape");if(i<e.post.args.length&&e.post.args[i].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof s||!s.offset)throw new Error("cwise: Unknown argument type "+r[i]);e.argTypes[i]="offset",e.offsetArgs.push({array:s.array,offset:s.offset}),e.offsetArgIndex.push(i)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!t.printCode||!!t.debug,e.funcName=t.funcName||"cwise",e.blockSize=t.blockSize||64,n(e)}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){"use strict";var n=r(5),a={body:"",args:[],thisVars:[],localVars:[]};function s(t){if(!t)return a;for(var e=0;e<t.args.length;++e){var r=t.args[e];t.args[e]=0===e?{name:r,lvalue:!0,rvalue:!!t.rvalue,count:t.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1}}return t.thisVars||(t.thisVars=[]),t.localVars||(t.localVars=[]),t}function o(t){for(var e=[],r=0;r<t.args.length;++r)e.push("a"+r);return new Function("P",["return function ",t.funcName,"_ndarrayops(",e.join(","),") {P(",e.join(","),");return a0}"].join(""))(function(t){return n({args:t.args,pre:s(t.pre),body:s(t.body),post:s(t.proc),funcName:t.funcName})}(t))}var h={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var t in h){var r=h[t];e[t]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:t}),e[t+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:t+"eq"}),e[t+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:t+"s"}),e[t+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:t+"seq"})}}();var l={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var t in l){var r=l[t];e[t]=o({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:t}),e[t+"eq"]=o({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:t+"eq"})}}();var u={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var t in u){var r=u[t];e[t]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:t}),e[t+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:t+"s"}),e[t+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:t+"eq"}),e[t+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:t+"seq"})}}();var c=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var t=0;t<c.length;++t){var r=c[t];e[r]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),e[r+"eq"]=o({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var f=["max","min","atan2","pow"];!function(){for(var t=0;t<f.length;++t){var r=f[t];e[r]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),e[r+"s"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),e[r+"eq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),e[r+"seq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var d=["atan2","pow"];!function(){for(var t=0;t<d.length;++t){var r=d[t];e[r+"op"]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),e[r+"ops"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),e[r+"opeq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),e[r+"opseq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),e.any=n({args:["array"],pre:a,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),e.all=n({args:["array"],pre:a,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),e.sum=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),e.prod=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),e.norm2squared=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),e.norm2=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),e.norminf=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),e.norm1=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),e.sup=n({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.inf=n({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.argmin=n({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.argmax=n({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.random=o({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),e.assign=o({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),e.assigns=o({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),e.equals=n({args:["array","array"],pre:a,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){const n=window.$,a=window._;var s=r(3),o=r(24);class h{constructor({meta:t,canvas:e,height:r,width:i,parentWidth:n,parentHeight:a,state:s,parent:o,mode:h,highlightColor:l,rootEl:u,captionParentEl:c}){this.meta=t,this.canvas=e,this.highlightColor=l,this.height=r,this.width=i,this.parentWidth=n,this.parentHeight=a,this.widthScale=this.width/this.meta.width,this.heightScale=this.height/this.meta.height,this.state=s,this.parent=o,this.mode=h,this.rootEl=u,this.captionParentEl=c,this.markerEl=this.rootEl.find(".thodio-marker"),this.initializeCanvas(e),"highlight"===h&&this.registerEvents(),this.renderedItemIds={}}setPage({data:t,background:e}){this.clear(),this.data=t,this.searchStroke=this.createSearchStrokeFunction(),this.bgColor=e}setData(t){return this.data=t,this.searchStroke=this.createSearchStrokeFunction(),this.itemSearch=new o.ItemSearch(this.data,this.widthScale,this.heightScale),this}initializeCanvas(t){n(this.canvas).attr("width",this.width).attr("height",this.height),this.ctx=t.getContext("2d"),this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.scale(this.widthScale,this.heightScale)}registerEvents(){let t=a.throttle(this.onMousemoved,300);n(this.canvas).mousemove(t.bind(this)).click(this.onClicked.bind(this)).mouseleave(this.onMouseleave.bind(this))}onMousemoved(t){this.clear(!1,!0),this.highlightStrokes(t);const e=this.itemSearch.search(t.offsetX,t.offsetY);this.highlightItems(e)}highlightStrokes(t){let e=[t.offsetX,t.offsetY];this.searchStroke(e).forEach(t=>{switch(t.type){case"stroke":this.renderStroke(t);break;case"line":this.renderLine(t);break;default:console.assert(!1)}})}onClicked(t){this.clear(!1,!0);let e=[t.offsetX,t.offsetY],r=this.searchStroke(e),i=this.itemSearch.search(e[0],e[1]),n=r.concat(i);const s=n.length;if(!s)return;const o=a.sortBy(n,"endtime"),{endtime:h}=o[s-1];this.parent.seekTo(h)}createSearchStrokeFunction(){let t=[];for(let e=0,r=this.data.length;e<r;e++){const r=this.data[e];if("stroke"===r.type){const e=r;for(let r=0,i=e.points.length;r<i;r++){const[i,n,a,s]=e.points[r],o=[n*this.widthScale,a*this.heightScale];o.item=e,t.push(o)}}else if("line"===r.type){let{x1:e,y1:i,x2:n,y2:a}=r;e>n&&([n,e]=[e,n],[a,i]=[i,a]);const s=4,o=a===i,h=o?null:(a-i)/(n-e),l=o?null:i-h*e;for(let a=e;a<=n;a+=s){let e;e=o?i:h*a+l;const n=[a*this.widthScale,e*this.heightScale];n.item=r,t.push(n)}}}const e=s(t);return function([r,i]){let n=[r-20,i-20],s=[r+20,i+20],o=[];return e.range(n,s,e=>o.push(t[e].item)),a.uniq(o,t=>t.id)}}renderBetween(t,e,r="default"){for(let i=0,n=this.data.length;i<n;i++){let n=this.data[i];if(n.begintime>e)break;if(!(n.begintime<t))if("stroke"!==n.type){if(!0!==this.renderedItemIds[n.id]){if("background"!==r&&(this.renderedItemIds[n.id]=!0),"background"===r&&"image"!==n.type){let t={};"math"!==n.type&&"text"!==n.type&&(t={width:1}),n=Object.assign({},n,{color:"#407640"},t)}switch(n.type){case"circle":this.renderCircle(n);break;case"ellipse":this.renderEllipse(n);break;case"rect":case"square":this.renderRect(n);break;case"grid":this.renderGrid(n);break;case"line":this.renderLine(n);break;case"text":this.renderText(n,"thodio-player-embedded-text",this.widthScale,this.heightScale);break;case"math":this.renderMath(n,"thodio-player-embedded-math",this.widthScale,this.heightScale);break;case"image":"background"===r?this.renderBackgroundImage(n,this.widthScale,this.heightScale):this.renderImage(n);break;case"frozenItem":this.renderItems(n.items);break;case"caption":case"still":break;case"pan":"background"!==r&&this.renderPan(n);break;default:console.assert("invalid mode"===n.type)}}}else this.renderStroke(n,r)}return this}highlightItems(t){for(let e=0,r=t.length;e<r;e++){let r=t[e];switch("image"!==r.type&&(r=Object.assign({},r,{color:"lime"})),r.type){case"circle":this.renderCircle(r);break;case"ellipse":this.renderEllipse(r);break;case"rect":case"square":this.renderRect(r);break;case"grid":this.renderGrid(r);break;case"text":this.renderText(r,"thodio-player-highlight-text",this.widthScale,this.heightScale);break;case"math":this.renderMath(r,"thodio-player-highlight-math",this.widthScale,this.heightScale);break;case"image":this.renderHighlightImage(r,this.widthScale,this.heightScale);break;case"frozenItem":this.highlightItems(r.items);break;default:console.assert("invalid mode"===r.type)}}}midPoint(t,e,r,i){return[(t+r)/2,(e+i)/2]}renderStroke(t,e="primary"){let{points:r,color:i,width:n}=t;"background"===e?(i=o.getWallflowerColor(this.bgColor),n=1):"highlight"===this.mode&&(i=this.highlightColor,n=2),this.drawStroke(this.ctx,{points:r,color:i,width:n})}clear(t=!0,e=!0){return this.ctx.clearRect(0,0,this.canvas.width/this.widthScale,this.canvas.height/this.heightScale),!0===e&&this.clearTextItems(),!0===t&&this.resetPan(),this.rootEl.find(".thodio-highlight-image-item").remove(),this.rootEl.find(".thodio-highlight-image-item-hider").remove(),this.renderedItemIds={},this}onMouseleave(){this.clear(!1,!0)}resetPan(){this.rootEl.css({left:"0px",top:"0px"})}async addPointsBetween(t,e){for(let r=0,i=this.data.length;r<i;r++){const i=this.data[r];if(i.begintime>e)break;if(!(i.endtime<t))if("stroke"===i.type)this.ctx.beginPath(),this.addStrokePointsBetween(i,t,e),this.ctx.stroke();else{if(!0===this.renderedItemIds[i.id])continue;switch(this.renderedItemIds[i.id]=!0,i.type){case"still":break;case"circle":this.renderCircle(i);break;case"ellipse":this.renderEllipse(i);break;case"rect":case"square":this.renderRect(i);break;case"grid":this.renderGrid(i);break;case"line":this.renderLine(i);break;case"text":this.renderText(i,"thodio-player-embedded-text",this.widthScale,this.heightScale);break;case"math":this.renderMath(i,"thodio-player-embedded-math",this.widthScale,this.heightScale);break;case"image":this.renderImage(i);break;case"caption":this.renderCaption(i);break;case"frozenItem":this.renderItems(i.items);break;case"pan":await this.playPan(i);break;default:console.assert("invalid mode"===i.type)}}}}addStrokePointsBetween(t,e,r){const{points:i,begintime:n,color:a,width:s}=t,o=i.length;if(0!==o){this.ctx.lineWidth=s,this.ctx.strokeStyle=a;for(let t=0;t<o;t++){let[a,s,h,l]=i[t];if((a+=n)<e||a>r)continue;this.ctx.moveTo(l.prev_midpoint.x,l.prev_midpoint.y),this.ctx.quadraticCurveTo(l.prev_point.x,l.prev_point.y,l.current_midpoint.x,l.current_midpoint.y);const u=this.widthScale*l.prev_midpoint.x,c=this.heightScale*l.prev_midpoint.y;0===t?this.markerEl.show():t===o-1&&this.markerEl.hide(),this.markerEl.css({left:`${u}px`,top:`${c}px`})}}}renderCaption({text:t,begintime:e,endtime:r,color:i}){if("preview"===this.mode)return;let a=n("<div>").addClass("thodio-caption").text(t).css({color:i});this.captionParentEl.append(a),setTimeout(()=>a.remove(),r-e)}renderPan({left:t,top:e}){t*=this.widthScale,e*=this.heightScale,t+this.parentWidth>this.width&&(t=this.width-this.parentWidth),e+this.parentHeight>this.height&&(e=this.height-this.parentHeight),this.rootEl.css({left:`-${t}px`,top:`-${e}px`})}playPan({left:t,top:e}){return t*=this.widthScale,e*=this.heightScale,t+this.parentWidth>this.width&&(t=this.width-this.parentWidth),e+this.parentHeight>this.height&&(e=this.height-this.parentHeight),new Promise((r,i)=>{this.rootEl.css({left:`-${t}px`,top:`-${e}px`}).one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",()=>r())})}}o.mixinCanvas(h.prototype);const l='\n  <div class=\'thodio-player\'>\n    <div class=\'thodio-controls\'>\n      <div class=\'thodio-slider-bg\'>\n      <div class=\'thodio-slider\'>\n      </div>\n\n        <div class="thodio-slider-watched"></div>\n      </div>\n      <div class="thodio-play-controls">\n        <span class="thodio-play-btn">▶</span>\n        <i class="fa fa-download" id="download-button" style="display: none"></i>\n        <span class="thodio-time thodio-current-time">00:00</span>\n        <span class="thodio-time"> / </span>\n        <span class="thodio-time thodio-duration"></span>\n        <div class="thodio-play-speed">\n          <span class="thodio-play-speed-label">Speed:</span>\n          <span class="thodio-play-speed-value">1x</span>\n          <div class="thodio-play-speed-options">\n            <span data-speed=\'1\'>    1x    </span>\n            <span data-speed=\'1.25\'> 1.25x </span>\n            <span data-speed=\'1.5\'>  1.5x  </span>\n            <span data-speed=\'2\'>    2x    </span>\n          </div>\n\n        </div>\n      </div>\n    </div>\n    <div class=\'thodio-heading\'>\n    </div>\n    <div class="thodio-views">\n      <div class="thodio-primary-view">\n        <div class="thodio-canvas-viewport">\n          <div class=\'thodio-canvas-content\'>\n            <canvas class="thodio-primary-canvas">\n            </canvas>\n            <canvas class="thodio-highlight-canvas">\n            </canvas>\n            <div class=\'thodio-highlight-items-root\'>\n            </div>\n            <div class="thodio-marker"></div>\n          </div>\n        </div>\n        <a href="" style="visibility: hidden" id="download-link"> Item </a>\n      </div>\n      <div class="thodio-page-previews">\n      </div>\n    </div>\n  </div>\n\n  ';class u{constructor({rootEl:t,data:e,audio:r}){this.rootEl=n(t),this.meta=e.meta,this.pages=e.pages,this.audio=r,this.state={isPaused:!0,currentTime:0,pageIndex:0,speed:1},this.audioEl=this.createAudioElement(this.audio)}render(){this.rootEl.html(l),this.renderPrimaryView().renderHeading(this.meta).renderTimeView(".thodio-duration",this.meta.duration).initializeSlider().setAudioSource(),this.registerEvents()}gotoFirstPage(){this.primaryCanvas.setPage(this.pages[0])}addAudioBindings(t){var e=this.rootEl.find(".thodio-play-btn");e.hide(),t.addEventListener("loadeddata",function(){console.log(t.readyState),t.readyState>=3&&e.show()})}createAudioElement(){return`<audio> <source src=${this.audio} type='audio/mp3'> </audio>`}setAudioSource(){this.rootEl.find(".thodio-controls").append(this.createAudioElement()),this.audioEl=this.rootEl.find("audio")[0],this.addAudioBindings(this.audioEl)}playAudioSource(t){!1!==this.meta.playAudio&&(console.log(this.audioEl),this.audioEl.play(),this.audioEl.currentTime=t)}stopAudioSource(){!1!==this.meta.playAudio&&this.audioEl.pause()}renderPrimaryView(){console.log("rendering"),this.viewportEl=this.rootEl.find(".thodio-canvas-viewport"),this.contentEl=this.rootEl.find(".thodio-canvas-content");const t=Math.floor(this.meta.width/1440*864),e=this.meta.height/900*540;this.width=t,this.height=e;const[r,i]=[1,1],[a,s]=[t,e],[l,u]=[a*r,s*i];this.viewportEl.css({width:`${t}px`,height:`${e}px`}),this.contentEl.css({width:`${l}px`,height:`${u}px`,left:"0px",top:"0px"});let c=this.contentEl.find("canvas")[0];console.log(c),c.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),n(c).css({width:`${l}px`,height:`${u}px`});const f=new h({width:l,height:u,parentWidth:t,parentHeight:e,meta:this.meta,state:this.state,parent:this,data:this.pages[0].data,canvas:c,mode:"primary",rootEl:this.contentEl,captionParentEl:this.viewportEl});this.primaryCanvas=f,this.gotoFirstPage(),f.renderBetween(0,this.meta.duration,"background"),(c=this.contentEl.find("canvas")[1]).getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio),n(c).css({width:`${l}px`,height:`${u}px`});const d=o.getHighlightColor(this.pages[0].background),p=this.contentEl.find(".thodio-highlight-items-root"),g=new h({width:l,height:u,meta:this.meta,state:this.state,parent:this,canvas:c,mode:"highlight",highlightColor:d,rootEl:p,captionParentEl:this.viewportEl});g.setData(this.pages[0].data),this.highlightCanvas=g,window.h=this.highlightCanvas;const y=this.pages[0].background;return this.contentEl.css({background:y}),this}renderHeading({title:t,author:e,width:r}){const i=r/1440*864;console.log("hw is ",i),console.log("hw will update ");const n=`${t} by ${e}`;return this.rootEl.find(".thodio-heading").html(n).width(i-5),this.rootEl.find(".thodio-controls").width(i),this}renderTimeView(t,e){let{minutes:r,seconds:i}=this.humanizeMillis(e);return this.rootEl.find(t).html(`${r}:${i}`),this}humanizeMillis(t){let e=Math.round(t/1e3),r=Math.floor(e/60),i=e-60*r;return r<10&&(r=`0${r}`),i<10&&(i=`0${i}`),{minutes:r,seconds:i}}initializeSlider(){return this.rootEl.find(".thodio-slider").slider({animate:"fast",change:this.onSlideDone.bind(this),slide:this.onSlide.bind(this)}),this}registerEvents(){return this.playBtn=this.rootEl.find(".thodio-play-btn"),this.playBtn.click(this.onPlayBtnClicked.bind(this)),this.rootEl.find(".thodio-slider-watched").click(this.onThodioSliderWatchedClicked.bind(this)),this.$speed=this.rootEl.find(".thodio-play-speed"),this.$speed.mouseenter(this.showSpeedOptions.bind(this)).mouseleave(this.hideSpeedOptions.bind(this)).click(this.onSpeedOptionClicked.bind(this)),this}beginPulse(){this._t1=new Date;let t=Math.floor(100);this.pulseTimer=setInterval(this.pulse.bind(this),t),window.stop=(()=>this.stopPulse())}stopPulse(){clearInterval(this.pulseTimer)}pulse(){if(!this.state.isPaused){const t=new Date;let e=(t-this._t1)*this.state.speed;this._t1=t;let r=this.state.currentTime,i=r+e;this.setCurrentTime(i);let{begintime:n,endtime:a}=this.pages[this.state.pageIndex];i>=n&&i<=a||this.setPage(i),this.primaryCanvas.addPointsBetween(r,i)}}setSpeed(t){this.state.speed=t,console.log(t),this.audioEl.playbackRate=t,this.$speed.find(".thodio-play-speed-value").html(`${t}x`)}showSpeedOptions(){this.$speed.find(".thodio-play-speed-options").css("visibility","visible")}hideSpeedOptions(){this.$speed.find(".thodio-play-speed-options").css("visibility","hidden")}onSpeedOptionClicked(t){let e=t.target.dataset.speed;e&&(this.hideSpeedOptions(),e=parseFloat(e,10),this.setSpeed(e))}setPage(t){const e=this.getPageIndexAt(t);if(void 0===e)this.stopPulse(),this.state.isPaused=!0,this.playBtn.html("▶");else{this.state.pageIndex=e;const t=this.pages[this.state.pageIndex];this.primaryCanvas.setPage(t)}}seekTo(t){this.stopPulse(),this.stopAudioSource();let{begintime:e,endtime:r}=this.pages[this.state.pageIndex];t>=e&&t<=r||this.setPage(t),this.primaryCanvas.clear().renderBetween(0,this.meta.duration,"background").renderBetween(0,t),this.setCurrentTime(t),this.state.isPaused||(this.beginPulse(),this.playAudioSource(this.state.currentTime/1e3))}setCurrentTime(t){this.state.currentTime=t;let e=100*t/this.meta.duration;e>100&&(e=100,this.reachedEnd=!0),this.updateSlideHandle(e).updateSliderWatched(e).renderTimeView(".thodio-current-time",this.state.currentTime)}getPageIndexAt(t){for(let e=0,r=this.pages.length;e<r;e++){let{begintime:r,endtime:i}=this.pages[e];if(t>=r&&t<=i)return e}}onPagePreviewClicked(t){let e=n(t.currentTarget).data("page-index"),{begintime:r}=this.pages[e];this.seekTo(r)}onSlide(t,e){this.updateSliderWatched(e.value)}onSlideDone(t,e){const r=this.meta.duration,i=Math.round(.01*e.value*r);this.seekTo(i)}updateSliderWatched(t){return this.rootEl.find(".thodio-slider-watched").css("width",`calc(${t}% - 5px)`),this}updateSlideHandle(t){return this.rootEl.find(".ui-slider-handle").css({left:`${t}%`,"z-index":3}),this}onPlayBtnClicked(){this.state.isPaused=!this.state.isPaused,this.state.isPaused?(this.playBtn.html("▶"),this.stopAudioSource(),clearInterval(this.pulseTimer)):(!0===this.reachedEnd?(this.reachedEnd=!1,this.seekTo(0)):(this.beginPulse(),this.playAudioSource(this.state.currentTime/1e3)),this.playBtn.html("||"))}onThodioSliderWatchedClicked(t){let e=t.offsetX/this.width,r=Math.round(e*this.meta.duration);this.seekTo(r)}}return{renderPlayer:function({rootEl:t,data:e,audio:r}){new u({rootEl:t,data:e,audio:r}).render()},version:"0.0.1"}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,r){"use strict";r.exports=function(t){for(var e=new Array(t),r=0;r<t;++r)e[r]=r;return e}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,r){"use strict";r.exports=function(t,e,r){if(e|=0,0===t.dimension||t.shape[0]<=e||e<0)return null;var i=!!r,n=_(t.order,i,t.dtype);return i?n(t,e,r):n(t,e)},r.exports.compile=_;var i="a",n="K",a="C",s="d",o="o",h="R",l="T",u="L",c="H",f="X";function d(t){return"s"+t}function p(t){return"t"+t}function g(t){return"u"+t}function y(t){return"v"+t}function v(t){return"i"+t}function m(t){return"p"+t}function b(t){return"x"+t}var w={};function _(t,e,r){var _=t.join()+e+r,x=w[_];return x||(w[_]=function(t,e,r){var w=(t=function(t){var e=t.slice();return e.splice(t.indexOf(0),1),e.unshift(0),e}(t)).length,_="generic"===r,x="ndSelect"+r+t.join("_")+"_"+(e?"cmp":"lex"),k=[],A=[i,n];e&&A.push(a);for(var E=[s+"="+i+".data",o+"="+i+".offset|0",h+"=Math.random",l],S=0;S<2;++S)E.push(b(S)+"=0");for(S=0;S<w;++S)E.push(d(S)+"="+i+".shape["+S+"]|0",p(S)+"="+i+".stride["+S+"]|0",v(S)+"=0");for(S=1;S<w;++S)S>1?E.push(y(S)+"=("+p(S)+"-"+d(S-1)+"*"+p(S-1)+")|0",g(t[S])+"=("+p(t[S])+"-"+d(t[S-1])+"*"+p(t[S-1])+")|0"):E.push(y(S)+"="+p(S),g(t[S])+"="+p(t[S]));if(e)for(S=0;S<2;++S)E.push(m(S)+"="+i+".pick(0)");function I(e,r){k.push(b(0),"=",o,"+",p(t[0]),"*(",e,");",b(1),"=",o,"+",p(t[0]),"*(",r,");");for(var i=w-1;i>0;--i)k.push("for(",v(t[i]),"=0;",v(t[i]),"<",d(t[i]),";",v(t[i]),"++){");for(_?k.push(l,"=",s,".get(",b(0),");",s,".set(",b(0),",",s,".get(",b(1),"));",s,".set(",b(1),",",l,");"):k.push(l,"=",s,"[",b(0),"];",s,"[",b(0),"]=",s,"[",b(1),"];",s,"[",b(1),"]=",l,";"),i=1;i<w;++i)k.push(b(0),"+=",g(t[i]),";",b(1),"+=",g(t[i]),"}")}E.push(f+"=0",u+"=0",c+"="+d(t[0])+"-1"),k.push("while(",u,"<",c,"){",f,"=(",h,"()*(",c,"-",u,"+1)+",u,")|0;"),I(f,c),k.push(f,"=",u,";","for(",v(0),"=",u,";",v(0),"<",c,";",v(0),"++){"),function(r,i,n){if(e)k.push(m(0),".offset=",o,"+",p(t[0]),"*(",i,");",m(1),".offset=",o,"+",p(t[0]),"*(",n,");",r,"=",a,"(",m(0),",",m(1),");");else{k.push(b(0),"=",o,"+",p(0),"*(",i,");",b(1),"=",o,"+",p(0),"*(",n,");"),w>1&&k.push("_cmp:");for(var h=w-1;h>0;--h)k.push("for(",v(h),"=0;",v(h),"<",d(h),";",v(h),"++){");for(_?k.push(r,"=",s,".get(",b(0),")-",s,".get(",b(1),");"):k.push(r,"=",s,"[",b(0),"]-",s,"[",b(1),"];"),w>1&&k.push("if(",r,")break _cmp;"),h=1;h<w;++h)k.push(b(0),"+=",y(h),";",b(1),"+=",y(h),"}")}}(l,v(0),c),k.push("if(",l,"<0){"),I(f,v(0)),k.push(f,"++;"),k.push("}}"),I(f,c),k.push("if(",f,"===",n,"){",u,"=",f,";","break;","}else if(",n,"<",f,"){",c,"=",f,"-1;","}else{",u,"=",f,"+1;","}","}"),e?k.push(m(0),".offset=",o,"+",u,"*",p(0),";","return ",m(0),";"):k.push("return ",i,".pick(",u,");");var P=["'use strict';function ",x,"(",A,"){","var ",E.join(),";",k.join(""),"};return ",x].join("");return new Function(P)()}(t,e,r))}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){"use strict";var n=r(0),a=r(11);i.exports=function(t,e){for(var r=[],i=t,s=1;Array.isArray(i);)r.push(i.length),s*=i.length,i=i[0];return 0===r.length?n():(e||(e=n(new Float64Array(s),r)),a(e,t),e)}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){i.exports=r(5)({args:["array","scalar","index"],pre:{body:"{}",args:[],thisVars:[],localVars:[]},body:{body:"{\nvar _inline_1_v=_inline_1_arg1_,_inline_1_i\nfor(_inline_1_i=0;_inline_1_i<_inline_1_arg2_.length-1;++_inline_1_i) {\n_inline_1_v=_inline_1_v[_inline_1_arg2_[_inline_1_i]]\n}\n_inline_1_arg0_=_inline_1_v[_inline_1_arg2_[_inline_1_arg2_.length-1]]\n}",args:[{name:"_inline_1_arg0_",lvalue:!0,rvalue:!1,count:1},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:1},{name:"_inline_1_arg2_",lvalue:!1,rvalue:!0,count:4}],thisVars:[],localVars:["_inline_1_i","_inline_1_v"]},post:{body:"{}",args:[],thisVars:[],localVars:[]},funcName:"convert",blockSize:64})}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){"use strict";var n=r(13);i.exports=function(t){var e=["'use strict'","var CACHED={}"],r=[],i=t.funcName+"_cwise_thunk";e.push(["return function ",i,"(",t.shimArgs.join(","),"){"].join(""));for(var a=[],s=[],o=[["array",t.arrayArgs[0],".shape.slice(",Math.max(0,t.arrayBlockIndices[0]),t.arrayBlockIndices[0]<0?","+t.arrayBlockIndices[0]+")":")"].join("")],h=[],l=[],u=0;u<t.arrayArgs.length;++u){var c=t.arrayArgs[u];r.push(["t",c,"=array",c,".dtype,","r",c,"=array",c,".order"].join("")),a.push("t"+c),a.push("r"+c),s.push("t"+c),s.push("r"+c+".join()"),o.push("array"+c+".data"),o.push("array"+c+".stride"),o.push("array"+c+".offset|0"),u>0&&(h.push("array"+t.arrayArgs[0]+".shape.length===array"+c+".shape.length+"+(Math.abs(t.arrayBlockIndices[0])-Math.abs(t.arrayBlockIndices[u]))),l.push("array"+t.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[0])+"]===array"+c+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[u])+"]"))}for(t.arrayArgs.length>1&&(e.push("if (!("+h.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),e.push("for(var shapeIndex=array"+t.arrayArgs[0]+".shape.length-"+Math.abs(t.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),e.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),e.push("}")),u=0;u<t.scalarArgs.length;++u)o.push("scalar"+t.scalarArgs[u]);return r.push(["type=[",s.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),e.push("var "+r.join(",")),e.push(["if(!proc){","CACHED[type]=proc=compile([",a.join(","),"])}","return proc(",o.join(","),")}"].join("")),t.debug&&console.log("-----Generated thunk:\n"+e.join("\n")+"\n----------"),new Function("compile",e.join("\n"))(n.bind(void 0,t))}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){"use strict";var n=r(14);function a(t,e,r){var i,n,a=t.length,s=e.arrayArgs.length,o=e.indexArgs.length>0,h=[],l=[],u=0,c=0;for(i=0;i<a;++i)l.push(["i",i,"=0"].join(""));for(n=0;n<s;++n)for(i=0;i<a;++i)c=u,u=t[i],0===i?l.push(["d",n,"s",i,"=t",n,"p",u].join("")):l.push(["d",n,"s",i,"=(t",n,"p",u,"-s",c,"*t",n,"p",c,")"].join(""));for(l.length>0&&h.push("var "+l.join(",")),i=a-1;i>=0;--i)u=t[i],h.push(["for(i",i,"=0;i",i,"<s",u,";++i",i,"){"].join(""));for(h.push(r),i=0;i<a;++i){for(c=u,u=t[i],n=0;n<s;++n)h.push(["p",n,"+=d",n,"s",i].join(""));o&&(i>0&&h.push(["index[",c,"]-=s",c].join("")),h.push(["++index[",u,"]"].join(""))),h.push("}")}return h.join("\n")}function s(t,e,r){for(var i=t.body,n=[],a=[],s=0;s<t.args.length;++s){var o=t.args[s];if(!(o.count<=0)){var h=new RegExp(o.name,"g"),l="",u=e.arrayArgs.indexOf(s);switch(e.argTypes[s]){case"offset":var c=e.offsetArgIndex.indexOf(s);u=e.offsetArgs[c].array,l="+q"+c;case"array":l="p"+u+l;var f="l"+s,d="a"+u;if(0===e.arrayBlockIndices[u])1===o.count?"generic"===r[u]?o.lvalue?(n.push(["var ",f,"=",d,".get(",l,")"].join("")),i=i.replace(h,f),a.push([d,".set(",l,",",f,")"].join(""))):i=i.replace(h,[d,".get(",l,")"].join("")):i=i.replace(h,[d,"[",l,"]"].join("")):"generic"===r[u]?(n.push(["var ",f,"=",d,".get(",l,")"].join("")),i=i.replace(h,f),o.lvalue&&a.push([d,".set(",l,",",f,")"].join(""))):(n.push(["var ",f,"=",d,"[",l,"]"].join("")),i=i.replace(h,f),o.lvalue&&a.push([d,"[",l,"]=",f].join("")));else{for(var p=[o.name],g=[l],y=0;y<Math.abs(e.arrayBlockIndices[u]);y++)p.push("\\s*\\[([^\\]]+)\\]"),g.push("$"+(y+1)+"*t"+u+"b"+y);if(h=new RegExp(p.join(""),"g"),l=g.join("+"),"generic"===r[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");i=i.replace(h,[d,"[",l,"]"].join(""))}break;case"scalar":i=i.replace(h,"Y"+e.scalarArgs.indexOf(s));break;case"index":i=i.replace(h,"index");break;case"shape":i=i.replace(h,"shape")}}}return[n.join("\n"),i,a.join("\n")].join("\n").trim()}i.exports=function(t,e){for(var r=e[1].length-Math.abs(t.arrayBlockIndices[0])|0,i=new Array(t.arrayArgs.length),o=new Array(t.arrayArgs.length),h=0;h<t.arrayArgs.length;++h)o[h]=e[2*h],i[h]=e[2*h+1];var l=[],u=[],c=[],f=[],d=[];for(h=0;h<t.arrayArgs.length;++h){t.arrayBlockIndices[h]<0?(c.push(0),f.push(r),l.push(r),u.push(r+t.arrayBlockIndices[h])):(c.push(t.arrayBlockIndices[h]),f.push(t.arrayBlockIndices[h]+r),l.push(0),u.push(t.arrayBlockIndices[h]));for(var p=[],g=0;g<i[h].length;g++)c[h]<=i[h][g]&&i[h][g]<f[h]&&p.push(i[h][g]-c[h]);d.push(p)}var y=["SS"],v=["'use strict'"],m=[];for(g=0;g<r;++g)m.push(["s",g,"=SS[",g,"]"].join(""));for(h=0;h<t.arrayArgs.length;++h){for(y.push("a"+h),y.push("t"+h),y.push("p"+h),g=0;g<r;++g)m.push(["t",h,"p",g,"=t",h,"[",c[h]+g,"]"].join(""));for(g=0;g<Math.abs(t.arrayBlockIndices[h]);++g)m.push(["t",h,"b",g,"=t",h,"[",l[h]+g,"]"].join(""))}for(h=0;h<t.scalarArgs.length;++h)y.push("Y"+h);if(t.shapeArgs.length>0&&m.push("shape=SS.slice(0)"),t.indexArgs.length>0){var b=new Array(r);for(h=0;h<r;++h)b[h]="0";m.push(["index=[",b.join(","),"]"].join(""))}for(h=0;h<t.offsetArgs.length;++h){var w=t.offsetArgs[h],_=[];for(g=0;g<w.offset.length;++g)0!==w.offset[g]&&(1===w.offset[g]?_.push(["t",w.array,"p",g].join("")):_.push([w.offset[g],"*t",w.array,"p",g].join("")));0===_.length?m.push("q"+h+"=0"):m.push(["q",h,"=",_.join("+")].join(""))}var x=n([].concat(t.pre.thisVars).concat(t.body.thisVars).concat(t.post.thisVars));for((m=m.concat(x)).length>0&&v.push("var "+m.join(",")),h=0;h<t.arrayArgs.length;++h)v.push("p"+h+"|=0");t.pre.body.length>3&&v.push(s(t.pre,t,o));var k=s(t.body,t,o),A=function(t){for(var e=0,r=t[0].length;e<r;){for(var i=1;i<t.length;++i)if(t[i][e]!==t[0][e])return e;++e}return e}(d);A<r?v.push(function(t,e,r,i){for(var n=e.length,s=r.arrayArgs.length,o=r.blockSize,h=r.indexArgs.length>0,l=[],u=0;u<s;++u)l.push(["var offset",u,"=p",u].join(""));for(u=t;u<n;++u)l.push(["for(var j"+u+"=SS[",e[u],"]|0;j",u,">0;){"].join("")),l.push(["if(j",u,"<",o,"){"].join("")),l.push(["s",e[u],"=j",u].join("")),l.push(["j",u,"=0"].join("")),l.push(["}else{s",e[u],"=",o].join("")),l.push(["j",u,"-=",o,"}"].join("")),h&&l.push(["index[",e[u],"]=j",u].join(""));for(u=0;u<s;++u){for(var c=["offset"+u],f=t;f<n;++f)c.push(["j",f,"*t",u,"p",e[f]].join(""));l.push(["p",u,"=(",c.join("+"),")"].join(""))}for(l.push(a(e,r,i)),u=t;u<n;++u)l.push("}");return l.join("\n")}(A,d[0],t,k)):v.push(a(d[0],t,k)),t.post.body.length>3&&v.push(s(t.post,t,o)),t.debug&&console.log("-----Generated cwise routine for ",e,":\n"+v.join("\n")+"\n----------");var E=[t.funcName||"unnamed","_cwise_loop_",i[0].join("s"),"m",A,function(t){for(var e=new Array(t.length),r=!0,i=0;i<t.length;++i){var n=t[i],a=n.match(/\d+/);a=a?a[0]:"",0===n.charAt(0)?e[i]="u"+n.charAt(1)+a:e[i]=n.charAt(0)+a,i>0&&(r=r&&e[i]===e[i-1])}return r?e[0]:e.join("")}(o)].join("");return new Function(["function ",E,"(",y.join(","),"){",v.join("\n"),"} return ",E].join(""))()}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,r){"use strict";r.exports=function(t,e,r){return 0===t.length?t:e?(r||t.sort(e),function(t,e){for(var r=1,i=t.length,n=t[0],a=t[0],s=1;s<i;++s)if(a=n,e(n=t[s],a)){if(s===r){r++;continue}t[r++]=n}return t.length=r,t}(t,e)):(r||t.sort(),function(t){for(var e=1,r=t.length,i=t[0],n=t[0],a=1;a<r;++a,n=i)if(n=i,(i=t[a])!==n){if(a===e){e++;continue}t[e++]=i}return t.length=e,t}(t))}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){"use strict";var n=r(0),a=r(6),s=r(1);e.clone=function(t){var e=t.dtype;"generic"!==e&&"array"!==e||(e="double");var r=s.malloc(t.size,e),i=n(r,t.shape);return a.assign(i,t),i},e.malloc=function(t,e){e||(e="double");for(var r=1,i=new Array(t.length),a=t.length-1;a>=0;--a)i[a]=r,r*=t[a];return n(s.malloc(r,e),t,i,0)},e.free=function(t){"generic"!==t.dtype&&"array"!==t.dtype&&s.free(t.data)},e.zeros=function(t,e){e||(e="double");for(var r=1,i=new Array(t.length),a=t.length-1;a>=0;--a)i[a]=r,r*=t[a];var o=s.malloc(r,e);for(a=0;a<r;++a)o[a]=0;return n(o,t,i,0)},e.ones=function(t,e){e||(e="double");for(var r=1,i=new Array(t.length),a=t.length-1;a>=0;--a)i[a]=r,r*=t[a];var o=s.malloc(r,e);for(a=0;a<r;++a)o[a]=1;return n(o,t,i,0)},e.eye=function(t,e){var r,i;e||(e="double");var a=1,o=new Array(t.length);for(r=t.length-1;r>=0;--r)o[r]=a,a*=t[r];var h=s.malloc(a,e);for(r=0;r<a;++r)h[r]=0;var l=1/0,u=0;for(r=t.length-1;r>=0;r--)u+=o[r],l=Math.min(l,t[r]);for(r=0,i=0;r<l;r++,i+=u)h[i]=1;return n(h,t,o,0)}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var i=r(18),n=r(19),a=r(20);function s(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,e){if(s()<e)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=h.prototype:(null===t&&(t=new h(e)),t.length=e),t}function h(t,e,r){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return c(this,t)}return l(this,t,e,r)}function l(t,e,r,i){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,i){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(i||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,r):new Uint8Array(e,r,i);h.TYPED_ARRAY_SUPPORT?(t=e).__proto__=h.prototype:t=f(t,e);return t}(t,e,r,i):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!h.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var i=0|p(e,r),n=(t=o(t,i)).write(e,r);n!==i&&(t=t.slice(0,n));return t}(t,e,r):function(t,e){if(h.isBuffer(e)){var r=0|d(e.length);return 0===(t=o(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(i=e.length)!=i?o(t,0):f(t,e);if("Buffer"===e.type&&a(e.data))return f(t,e.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function c(t,e){if(u(e),t=o(t,e<0?0:0|d(e)),!h.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function f(t,e){var r=e.length<0?0:0|d(e.length);t=o(t,r);for(var i=0;i<r;i+=1)t[i]=255&e[i];return t}function d(t){if(t>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|t}function p(t,e){if(h.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return F(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return L(t).length;default:if(i)return F(t).length;e=(""+e).toLowerCase(),i=!0}}function g(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function y(t,e,r,i,n){if(0===t.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=n?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(n)return-1;r=t.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof e&&(e=h.from(e,i)),h.isBuffer(e))return 0===e.length?-1:v(t,e,r,i,n);if("number"==typeof e)return e&=255,h.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):v(t,[e],r,i,n);throw new TypeError("val must be string, number or Buffer")}function v(t,e,r,i,n){var a,s=1,o=t.length,h=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;s=2,o/=2,h/=2,r/=2}function l(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(n){var u=-1;for(a=r;a<o;a++)if(l(t,a)===l(e,-1===u?0:a-u)){if(-1===u&&(u=a),a-u+1===h)return u*s}else-1!==u&&(a-=a-u),u=-1}else for(r+h>o&&(r=o-h),a=r;a>=0;a--){for(var c=!0,f=0;f<h;f++)if(l(t,a+f)!==l(e,f)){c=!1;break}if(c)return a}return-1}function m(t,e,r,i){r=Number(r)||0;var n=t.length-r;i?(i=Number(i))>n&&(i=n):i=n;var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");i>a/2&&(i=a/2);for(var s=0;s<i;++s){var o=parseInt(e.substr(2*s,2),16);if(isNaN(o))return s;t[r+s]=o}return s}function b(t,e,r,i){return $(F(e,t.length-r),t,r,i)}function w(t,e,r,i){return $(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,i)}function _(t,e,r,i){return w(t,e,r,i)}function x(t,e,r,i){return $(L(e),t,r,i)}function k(t,e,r,i){return $(function(t,e){for(var r,i,n,a=[],s=0;s<t.length&&!((e-=2)<0);++s)r=t.charCodeAt(s),i=r>>8,n=r%256,a.push(n),a.push(i);return a}(e,t.length-r),t,r,i)}function A(t,e,r){return 0===e&&r===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,r))}function E(t,e,r){r=Math.min(t.length,r);for(var i=[],n=e;n<r;){var a,s,o,h,l=t[n],u=null,c=l>239?4:l>223?3:l>191?2:1;if(n+c<=r)switch(c){case 1:l<128&&(u=l);break;case 2:128==(192&(a=t[n+1]))&&(h=(31&l)<<6|63&a)>127&&(u=h);break;case 3:a=t[n+1],s=t[n+2],128==(192&a)&&128==(192&s)&&(h=(15&l)<<12|(63&a)<<6|63&s)>2047&&(h<55296||h>57343)&&(u=h);break;case 4:a=t[n+1],s=t[n+2],o=t[n+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(h=(15&l)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&h<1114112&&(u=h)}null===u?(u=65533,c=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),n+=c}return function(t){var e=t.length;if(e<=S)return String.fromCharCode.apply(String,t);var r="",i=0;for(;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=S));return r}(i)}e.Buffer=h,e.SlowBuffer=function(t){+t!=t&&(t=0);return h.alloc(+t)},e.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),h.poolSize=8192,h._augment=function(t){return t.__proto__=h.prototype,t},h.from=function(t,e,r){return l(null,t,e,r)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(t,e,r){return function(t,e,r,i){return u(e),e<=0?o(t,e):void 0!==r?"string"==typeof i?o(t,e).fill(r,i):o(t,e).fill(r):o(t,e)}(null,t,e,r)},h.allocUnsafe=function(t){return c(null,t)},h.allocUnsafeSlow=function(t){return c(null,t)},h.isBuffer=function(t){return!(null==t||!t._isBuffer)},h.compare=function(t,e){if(!h.isBuffer(t)||!h.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,i=e.length,n=0,a=Math.min(r,i);n<a;++n)if(t[n]!==e[n]){r=t[n],i=e[n];break}return r<i?-1:i<r?1:0},h.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(t,e){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return h.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var i=h.allocUnsafe(e),n=0;for(r=0;r<t.length;++r){var s=t[r];if(!h.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,n),n+=s.length}return i},h.byteLength=p,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},h.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},h.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},h.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?E(this,0,t):function(t,e,r){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,r);case"utf8":case"utf-8":return E(this,e,r);case"ascii":return I(this,e,r);case"latin1":case"binary":return P(this,e,r);case"base64":return A(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,e,r);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}.apply(this,arguments)},h.prototype.equals=function(t){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===h.compare(this,t)},h.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},h.prototype.compare=function(t,e,r,i,n){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),e<0||r>t.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&e>=r)return 0;if(i>=n)return-1;if(e>=r)return 1;if(this===t)return 0;for(var a=(n>>>=0)-(i>>>=0),s=(r>>>=0)-(e>>>=0),o=Math.min(a,s),l=this.slice(i,n),u=t.slice(e,r),c=0;c<o;++c)if(l[c]!==u[c]){a=l[c],s=u[c];break}return a<s?-1:s<a?1:0},h.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},h.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},h.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},h.prototype.write=function(t,e,r,i){if(void 0===e)i="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)i=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-e;if((void 0===r||r>n)&&(r=n),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return m(this,t,e,r);case"utf8":case"utf-8":return b(this,t,e,r);case"ascii":return w(this,t,e,r);case"latin1":case"binary":return _(this,t,e,r);case"base64":return x(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,r);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function I(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(127&t[n]);return i}function P(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(t[n]);return i}function T(t,e,r){var i=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>i)&&(r=i);for(var n="",a=e;a<r;++a)n+=Y(t[a]);return n}function j(t,e,r){for(var i=t.slice(e,r),n="",a=0;a<i.length;a+=2)n+=String.fromCharCode(i[a]+256*i[a+1]);return n}function R(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function B(t,e,r,i,n,a){if(!h.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<a)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}function V(t,e,r,i){e<0&&(e=65535+e+1);for(var n=0,a=Math.min(t.length-r,2);n<a;++n)t[r+n]=(e&255<<8*(i?n:1-n))>>>8*(i?n:1-n)}function C(t,e,r,i){e<0&&(e=4294967295+e+1);for(var n=0,a=Math.min(t.length-r,4);n<a;++n)t[r+n]=e>>>8*(i?n:3-n)&255}function M(t,e,r,i,n,a){if(r+i>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(t,e,r,i,a){return a||M(t,0,r,4),n.write(t,e,r,i,23,4),r+4}function N(t,e,r,i,a){return a||M(t,0,r,8),n.write(t,e,r,i,52,8),r+8}h.prototype.slice=function(t,e){var r,i=this.length;if((t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t),h.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=h.prototype;else{var n=e-t;r=new h(n,void 0);for(var a=0;a<n;++a)r[a]=this[a+t]}return r},h.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||R(t,e,this.length);for(var i=this[t],n=1,a=0;++a<e&&(n*=256);)i+=this[t+a]*n;return i},h.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||R(t,e,this.length);for(var i=this[t+--e],n=1;e>0&&(n*=256);)i+=this[t+--e]*n;return i},h.prototype.readUInt8=function(t,e){return e||R(t,1,this.length),this[t]},h.prototype.readUInt16LE=function(t,e){return e||R(t,2,this.length),this[t]|this[t+1]<<8},h.prototype.readUInt16BE=function(t,e){return e||R(t,2,this.length),this[t]<<8|this[t+1]},h.prototype.readUInt32LE=function(t,e){return e||R(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},h.prototype.readUInt32BE=function(t,e){return e||R(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},h.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||R(t,e,this.length);for(var i=this[t],n=1,a=0;++a<e&&(n*=256);)i+=this[t+a]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*e)),i},h.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||R(t,e,this.length);for(var i=e,n=1,a=this[t+--i];i>0&&(n*=256);)a+=this[t+--i]*n;return a>=(n*=128)&&(a-=Math.pow(2,8*e)),a},h.prototype.readInt8=function(t,e){return e||R(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},h.prototype.readInt16LE=function(t,e){e||R(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt16BE=function(t,e){e||R(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt32LE=function(t,e){return e||R(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},h.prototype.readInt32BE=function(t,e){return e||R(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},h.prototype.readFloatLE=function(t,e){return e||R(t,4,this.length),n.read(this,t,!0,23,4)},h.prototype.readFloatBE=function(t,e){return e||R(t,4,this.length),n.read(this,t,!1,23,4)},h.prototype.readDoubleLE=function(t,e){return e||R(t,8,this.length),n.read(this,t,!0,52,8)},h.prototype.readDoubleBE=function(t,e){return e||R(t,8,this.length),n.read(this,t,!1,52,8)},h.prototype.writeUIntLE=function(t,e,r,i){(t=+t,e|=0,r|=0,i)||B(this,t,e,r,Math.pow(2,8*r)-1,0);var n=1,a=0;for(this[e]=255&t;++a<r&&(n*=256);)this[e+a]=t/n&255;return e+r},h.prototype.writeUIntBE=function(t,e,r,i){(t=+t,e|=0,r|=0,i)||B(this,t,e,r,Math.pow(2,8*r)-1,0);var n=r-1,a=1;for(this[e+n]=255&t;--n>=0&&(a*=256);)this[e+n]=t/a&255;return e+r},h.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,1,255,0),h.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},h.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):V(this,t,e,!0),e+2},h.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):V(this,t,e,!1),e+2},h.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):C(this,t,e,!0),e+4},h.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):C(this,t,e,!1),e+4},h.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e|=0,!i){var n=Math.pow(2,8*r-1);B(this,t,e,r,n-1,-n)}var a=0,s=1,o=0;for(this[e]=255&t;++a<r&&(s*=256);)t<0&&0===o&&0!==this[e+a-1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+r},h.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e|=0,!i){var n=Math.pow(2,8*r-1);B(this,t,e,r,n-1,-n)}var a=r-1,s=1,o=0;for(this[e+a]=255&t;--a>=0&&(s*=256);)t<0&&0===o&&0!==this[e+a+1]&&(o=1),this[e+a]=(t/s>>0)-o&255;return e+r},h.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,1,127,-128),h.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},h.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):V(this,t,e,!0),e+2},h.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):V(this,t,e,!1),e+2},h.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):C(this,t,e,!0),e+4},h.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||B(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):C(this,t,e,!1),e+4},h.prototype.writeFloatLE=function(t,e,r){return U(this,t,e,!0,r)},h.prototype.writeFloatBE=function(t,e,r){return U(this,t,e,!1,r)},h.prototype.writeDoubleLE=function(t,e,r){return N(this,t,e,!0,r)},h.prototype.writeDoubleBE=function(t,e,r){return N(this,t,e,!1,r)},h.prototype.copy=function(t,e,r,i){if(r||(r=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);var n,a=i-r;if(this===t&&r<e&&e<i)for(n=a-1;n>=0;--n)t[n+e]=this[n+r];else if(a<1e3||!h.TYPED_ARRAY_SUPPORT)for(n=0;n<a;++n)t[n+e]=this[n+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+a),e);return a},h.prototype.fill=function(t,e,r,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),1===t.length){var n=t.charCodeAt(0);n<256&&(t=n)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!h.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var a;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(a=e;a<r;++a)this[a]=t;else{var s=h.isBuffer(t)?t:F(new h(t,i).toString()),o=s.length;for(a=0;a<r-e;++a)this[a+e]=s[a%o]}return this};var O=/[^+\/0-9A-Za-z-_]/g;function Y(t){return t<16?"0"+t.toString(16):t.toString(16)}function F(t,e){var r;e=e||1/0;for(var i=t.length,n=null,a=[],s=0;s<i;++s){if((r=t.charCodeAt(s))>55295&&r<57344){if(!n){if(r>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(s+1===i){(e-=3)>-1&&a.push(239,191,189);continue}n=r;continue}if(r<56320){(e-=3)>-1&&a.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(e-=3)>-1&&a.push(239,191,189);if(n=null,r<128){if((e-=1)<0)break;a.push(r)}else if(r<2048){if((e-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function L(t){return i.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(O,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function $(t,e,r,i){for(var n=0;n<i&&!(n+r>=e.length||n>=t.length);++n)e[n+r]=t[n];return n}}).call(this,r(17))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";e.byteLength=function(t){var e=l(t),r=e[0],i=e[1];return 3*(r+i)/4-i},e.toByteArray=function(t){for(var e,r=l(t),i=r[0],s=r[1],o=new a(function(t,e,r){return 3*(e+r)/4-r}(0,i,s)),h=0,u=s>0?i-4:i,c=0;c<u;c+=4)e=n[t.charCodeAt(c)]<<18|n[t.charCodeAt(c+1)]<<12|n[t.charCodeAt(c+2)]<<6|n[t.charCodeAt(c+3)],o[h++]=e>>16&255,o[h++]=e>>8&255,o[h++]=255&e;2===s&&(e=n[t.charCodeAt(c)]<<2|n[t.charCodeAt(c+1)]>>4,o[h++]=255&e);1===s&&(e=n[t.charCodeAt(c)]<<10|n[t.charCodeAt(c+1)]<<4|n[t.charCodeAt(c+2)]>>2,o[h++]=e>>8&255,o[h++]=255&e);return o},e.fromByteArray=function(t){for(var e,r=t.length,n=r%3,a=[],s=0,o=r-n;s<o;s+=16383)a.push(u(t,s,s+16383>o?o:s+16383));1===n?(e=t[r-1],a.push(i[e>>2]+i[e<<4&63]+"==")):2===n&&(e=(t[r-2]<<8)+t[r-1],a.push(i[e>>10]+i[e>>4&63]+i[e<<2&63]+"="));return a.join("")};for(var i=[],n=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=s.length;o<h;++o)i[o]=s[o],n[s.charCodeAt(o)]=o;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function u(t,e,r){for(var n,a,s=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),s.push(i[(a=n)>>18&63]+i[a>>12&63]+i[a>>6&63]+i[63&a]);return s.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,r,i,n){var a,s,o=8*n-i-1,h=(1<<o)-1,l=h>>1,u=-7,c=r?n-1:0,f=r?-1:1,d=t[e+c];for(c+=f,a=d&(1<<-u)-1,d>>=-u,u+=o;u>0;a=256*a+t[e+c],c+=f,u-=8);for(s=a&(1<<-u)-1,a>>=-u,u+=i;u>0;s=256*s+t[e+c],c+=f,u-=8);if(0===a)a=1-l;else{if(a===h)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,i),a-=l}return(d?-1:1)*s*Math.pow(2,a-i)},e.write=function(t,e,r,i,n,a){var s,o,h,l=8*a-n-1,u=(1<<l)-1,c=u>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:a-1,p=i?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-s))<1&&(s--,h*=2),(e+=s+c>=1?f/h:f*Math.pow(2,1-c))*h>=2&&(s++,h/=2),s+c>=u?(o=0,s=u):s+c>=1?(o=(e*h-1)*Math.pow(2,n),s+=c):(o=e*Math.pow(2,c-1)*Math.pow(2,n),s=0));n>=8;t[r+d]=255&o,d+=p,o/=256,n-=8);for(s=s<<n|o,l+=n;l>0;t[r+d]=255&s,d+=p,s/=256,l-=8);t[r+d-p]|=128*g}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){var i;void 0===(i=function(t,e,r){"use strict";r.exports=function(t,e){switch(void 0===e&&(e=0),typeof t){case"number":if(t>0)return function(t,e){var r,i;for(r=new Array(t),i=0;i<t;++i)r[i]=e;return r}(0|t,e);break;case"object":if("number"==typeof t.length)return function t(e,r,i){var n=0|e[i];if(n<=0)return[];var a,s=new Array(n);if(i===e.length-1)for(a=0;a<n;++a)s[a]=r;else for(a=0;a<n;++a)s[a]=t(e,r,i+1);return s}(t,e,0)}return[]}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){"use strict";var n=r(2);function a(t){var e=(n.nextPow2(t+1)>>>1)-1,r=t-e;return n.nextPow2(r)-1>=e?e:(e>>>1)+r}function s(t,e){if(t<=0)return 0;var r=a(t);return e>r?s(t-r-1,e-r-1):e===r?n.log2(t):s(r,e)}e.root=a,e.begin=function(t){return 0},e.end=function(t){return t-1},e.height=s,e.prev=function(t,e){return Math.max(e-1,0)},e.next=function(t,e){return Math.min(e+1,t-1)},e.parent=function t(e,r){if(e<=0)return-1;var i,n=a(e);return r>n?(i=t(e-n-1,r-n-1))<0?n:i+n+1:r===n?-1:(i=t(n,r))<0?n:i},e.left=function t(e,r){if(e<=0)return 0;var i=a(e);return r>i?t(e-i-1,r-i-1)+i+1:r===i?a(r):t(i,r)},e.right=function t(e,r){if(e<=0)return 0;var i=a(e);return r>i?t(e-i-1,r-i-1)+i+1:r===i?a(e-i-1)+i+1:t(i,r)},e.leaf=function(t,e){return 0===s(t,e)},e.lo=function(t,e){t|=0,e|=0;for(var r=0;t>1;){var i=a(t);if(e>i)r+=i+1,t-=i+1,e-=i+1;else{if(e===i)break;t=i}}return r},e.hi=function(t,e){t|=0,e|=0;for(var r=0;t>1;){var i=a(t);if(e>i)r+=i+1,t-=i+1,e-=i+1;else{if(e===i){r+=t-1;break}t=i}}return r}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){"use strict";i.exports=s;var n=r(1);function a(t){return 1&t?t-1>>1:(t>>1)-1}function s(t,e){this.count=0,this.dataSize=e,this.index=n.mallocInt32(t),this.data=n.mallocFloat64(t*e)}var o=s.prototype;o.heapSwap=function(t,e){var r=this.data,i=this.index,n=this.dataSize,a=i[t];i[t]=i[e],i[e]=a;for(var s=n*t,o=n*e,h=0;h<n;++h){var l=r[s];r[s]=r[o],r[o]=l,s+=1,o+=1}},o.heapUp=function(t){for(var e=this.dataSize,r=(this.index,this.data),i=r[e*t];t>0;){var n=a(t);if(n>=0)if(i<r[e*n]){this.heapSwap(t,n),t=n;continue}break}},o.heapDown=function(t){for(var e=this.dataSize,r=(this.index,this.data),i=this.count,n=r[e*t];;){var a=n,s=2*t+1,o=2*(t+1),h=t;if(s<i){var l=r[e*s];l<a&&(h=s,a=l)}if(o<i)r[e*o]<a&&(h=o);if(h===t)break;this.heapSwap(t,h),t=h}},o.pop=function(){this.count-=1,this.heapSwap(0,this.count),this.heapDown(0)},o.push=function(){this.heapUp(this.count),this.count+=1},o.dispose=function(){n.freeInt32(this.index),n.freeFloat64(this.data)}}.call(e,r,e,t))||(t.exports=i)},function(t,e,r){var i;void 0===(i=function(t,e,i){var n=r(3);window.kd=n;const a=window.$,s=window._;function o(t){return[(t=t.slice(1)).slice(0,2),t.slice(2,4),t.slice(4,6)].map(t=>parseInt(t,16))}function h(t){var e="rgb("+(t=t.replace("#","")).match(new RegExp("(.{"+t.length/3+"})","g")).map(function(e){return parseInt(t.length%2?e+e:e,16)}).join(",")+")",r=(e=e.replace(/[^\d,]/g,"").split(","))[0],i=e[1],n=e[2];r/=255,i/=255,n/=255;var a,s,o=Math.max(r,i,n),h=Math.min(r,i,n),l=(o+h)/2;if(o===h)a=s=0;else{var u=o-h;s=l>.5?u/(2-o-h):u/(o+h),o===r&&i>=n?a=1.0472*(i-n)/u:o===r&&i<n?a=1.0472*(i-n)/u+6.2832:o===i?a=1.0472*(n-r)/u+2.0944:o===n&&(a=1.0472*(r-i)/u+4.1888)}if(a=a/6.2832*360+0,(a+=180)>360&&(a-=360),a/=360,0===s)r=i=n=l;else{var c=function(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t},f=l<.5?l*(1+s):l+s-l*s,d=2*l-f;r=c(d,f,a+1/3),i=c(d,f,a),n=c(d,f,a-1/3)}return r=Math.round(255*r),i=Math.round(255*i),"#"+(16777216|(e=(n=Math.round(255*n))|i<<8|r<<16)).toString(16).substring(1)}const l={initializeCtx(){const t=this.refs.canvas;this.ctx=t.getContext("2d"),this.ctx.lineJoin="round",this.ctx.lineCap="round";const[e,r]=[t.width,t.height];this.width=e,this.height=r},clear(t=1,e=1){let r=this.refs.canvas;return this.ctx.clearRect(0,0,r.width/t,r.height/e),this.clearTextItems(),"function"==typeof this.resetPan&&this.resetPan(),this},clearTextItems(){return this.rootEl&&[".creator-embedded-text",".creator-embedded-math",".thodio-player-embedded-text",".thodio-player-embedded-math",".thodio-player-highlight-text",".thodio-player-highlight-math",".thodio-caption"].forEach(t=>this.rootEl.find(t).remove()),this},clearAndRenderPage({page:t},e=1,r=1){this.clear(e,r),this.setBackground(t.background),this.renderItems(t.items)},setBackground(t){this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.width,this.height)},midPoint:(t,e,r,i)=>[(t+r)/2,(e+i)/2],distance(t,e,r,i){let n=r-t,a=i-e;return Math.sqrt(n*n+a*a)},renderItems(t){window.items=t;for(let e=0,r=t.length;e<r;e++){const r=t[e];switch(r.type){case"stroke":this.renderStroke(r);break;case"circle":this.renderCircle(r);break;case"ellipse":this.renderEllipse(r);break;case"rect":case"square":this.renderRect(r);break;case"grid":this.renderGrid(r);break;case"line":this.renderLine(r);break;case"text":this.renderText(r,"creator-embedded-text");break;case"image":this.renderImage(r);break;case"math":this.renderMath(r,"creator-embedded-math");break;case"caption":break;case"frozenItem":this.renderItems(r.items);break;case"pan":this._renderPan(r);break;case"still":break;default:console.assert("invalid mode"===r.type)}}},renderStroke(t){this.drawStroke(this.ctx,t)},drawStroke(t,{points:e,color:r,width:i}){const n=e.length;if(n<3)return;t.lineWidth=i,t.strokeStyle=r;let[a,s,o]=e[0],[h,l,u]=e[1];t.beginPath();for(let r=2;r<n;r++){let[i,n,a]=e[r],[h,c]=this.midPoint(s,o,l,u),[f,d]=this.midPoint(l,u,n,a);t.moveTo(h,c),t.quadraticCurveTo(l,u,f,d),s=l,o=u,l=n,u=a}t.stroke(),window.points=e,window.cm=this},delimitStroke({points:t}){let e=1/0,r=1/0,i=-1/0,n=-1/0;for(let[a,s,o]of t)e=e<s?e:s,i=i>s?i:s,r=r<o?r:o,n=n>o?n:o;return[e,r,i,n]},drawCircle(t,{center:e,radius:r,color:i,width:n}){let[a,s]=e;t.lineWidth=n,t.strokeStyle=i,t.beginPath(),t.arc(a,s,r,0,2*Math.PI),t.stroke()},renderCircle(t){this.drawCircle(this.ctx,t)},delimitCircle({center:t,radius:e,width:r}){const[i,n]=t;return[i-e-r,n-e-r,i+e+r,n+e+r]},drawEllipse(t,{x:e,y:r,radiusX:i,radiusY:n,color:a,width:s}){t.lineWidth=s,t.strokeStyle=a,t.beginPath(),t.ellipse(e,r,i,n,0,0,2*Math.PI),t.stroke()},renderEllipse(t){this.drawEllipse(this.ctx,t)},delimitEllipse:({x:t,y:e,radiusX:r,radiusY:i,width:n})=>[t-r-n,e-i-n,t+r+n,e+i+n],renderLine(t){this.drawLine(this.ctx,t)},drawLine(t,{x1:e,y1:r,x2:i,y2:n,color:a,width:s}){t.lineWidth=s,t.strokeStyle=a,t.beginPath(),t.moveTo(e,r),t.lineTo(i,n),t.stroke()},delimitLine:({x1:t,y1:e,x2:r,y2:i,width:n})=>(t>r&&([r,t]=[t,r]),e>i&&([i,e]=[e,i]),[t-n,e-n,r+n,i+n]),renderRect(t){this.drawRect(this.ctx,t)},drawRect(t,{x1:e,y1:r,x2:i,y2:n,color:a,width:s}){e>i&&([i,e]=[e,i]),r>n&&([n,r]=[r,n]),t.lineWidth=s,t.strokeStyle=a,t.beginPath(),t.rect(e,r,i-e,n-r),t.stroke()},delimitRect:({x1:t,y1:e,x2:r,y2:i,width:n})=>(t>r&&([r,t]=[t,r]),e>i&&([i,e]=[e,i]),[t-n,e-n,r+n,i+n]),renderSquare(t){this.drawRect(this.ctx,t)},renderGrid(t){this.drawGrid(this.ctx,t)},drawGrid(t,{rows:e,cols:r,x1:i,y1:n,cellWidth:a,cellHeight:s,color:o,width:h}){t.lineWidth=h,t.strokeStyle=o;for(let l=0;l<e;l++)for(let e=0;e<r;e++)this.drawRect(t,{x1:i+e*a,y1:n+l*s,x2:i+(e+1)*a,y2:n+(l+1)*s,color:o,width:h})},delimitGrid:({rows:t,cols:e,x1:r,y1:i,cellWidth:n,cellHeight:a,width:s})=>[r-s,i-s,r+e*(n+s),i+t*(a+s)],textAndMathToHTML(t){const e=t.match(/\$(.*?)\$/g);if(null===e)return t;const r=e.map(t=>renderToString(t.slice(1,t.length-1)));for(let i=0,n=e.length;i<n;i++)t=t.replace(e[i],r[i]);return t},renderText({left:t,top:e,text:r,color:i,fontsize:n,fontfamily:s,width:o,height:h,lineheight:l,elementID:u},c="",f=1,d=1){t*=f,e*=d,r=this.textAndMathToHTML(r);var p=a("<div>").html(r).css({position:"absolute",left:`${t}px`,top:`${e}px`,height:`${h}px`,"line-height":`${l}px`,width:`${o*f}px`,"font-size":`${n*d}px`,"font-family":s,padding:"6px",color:i}).addClass(c).addClass(`thodio-text unselectable text-${u}`);this.rootEl.append(p)},delimitText:({left:t,top:e,width:r,height:i})=>[t,e,t+r,e+i],removeText({elementID:t}){this.rootEl.find(`.text-${t}`).remove()},renderImage({dataURI:t,left:e,top:r,width:i,height:n}){const a=new Image;a.src=t;let s=this;a.onload=(()=>{s.ctx.drawImage(a,e,r,i,n)})},delimitImage:({left:t,top:e,width:r,height:i})=>[t,e,t+r,e+i],renderBackgroundImage({dataURI:t,left:e,top:r,width:i,height:n},s=1,o=1){const h={left:`${e*s}px`,top:`${r*o}px`,width:`${i*s}px`,height:`${n*o}px`},l=a("<img>").attr("src",t).css(h).addClass("thodio-background-image-item"),u=a("<div>").css(h).addClass("thodio-background-image-item-hider");this.rootEl.append(l).append(u)},renderHighlightImage({dataURI:t,left:e,top:r,width:i,height:n},s=1,o=1){const h={left:`${e*s}px`,top:`${r*o}px`,width:`${i*s}px`,height:`${n*o}px`},l=a("<img>").attr("src",t).css(h).addClass("thodio-highlight-image-item"),u=a("<div>").css(h).addClass("thodio-highlight-image-item-hider");this.rootEl.append(l).append(u)},renderMath({tex:t,left:e,top:r,color:i,fontsize:n},s="",o=1,h=1){e*=o,r*=h;const l=renderToString(t),u=a("<div>").addClass(s).html(l).css({"font-size":`${n*h}px`,padding:"6px",position:"absolute",left:`${e}px`,top:`${r}px`,color:i});this.rootEl.append(u)},delimitFrozenItem({items:t}){const e=t.map(t=>this.delimitItem(t));let r=1/0,i=-1/0,n=1/0,a=-1/0;for(let[t,s,o,h]of e)r=r<t?r:t,n=n<s?n:s,i=i>o?i:o,a=a>h?a:h;return[r,n,i,a]},delimitItem(t){switch(t.type){case"stroke":return this.delimitStroke(t);case"circle":return this.delimitCircle(t);case"ellipse":return this.delimitEllipse(t);case"rect":case"square":return this.delimitRect(t);case"grid":return this.delimitGrid(t);case"line":return this.delimitLine(t);case"text":return this.delimitText(t);case"image":return this.delimitImage(t);case"frozenItem":return this.delimitFrozenItem(t);case"caption":case"pan":return[0,0,0,0];default:console.assert("invalid mode"===t.type)}},clearRectArea(t,e){t.type;const[r,i,n,a]=this.delimitItem(t),{width:s}=t;this.ctx.fillStyle=e,this.ctx.fillRect(r-s,i-s,n-r+2*s,a-i+2*s)},removeItem(t,e){switch(t.type){case"stroke":case"circle":case"ellipse":case"rect":case"square":case"grid":case"line":this.clearRectArea(t,e);break;case"text":this.removeText(t);break;case"image":const{left:r,top:i,width:n,height:a}=t;this.ctx.fillStyle=e,this.ctx.fillRect(r,i,n,a);break;case"frozenItem":const{items:s}=t;s.forEach(t=>this.removeItem(t,e));break;case"pan":case"caption":break;default:console.assert("invalid mode"===t.type)}},doesSpaceOverlap(t,e){let[r,i,n,a]=this.delimitItem(e);const[s,o,h,l]=this.delimitItem(t);return!(s>n||h<r)&&!(o>a||l<i)},doesTimeOverlap(t,e,r){const{begintime:i,endtime:n}=t;return console.assert(e<=r),i<=r&&n>=e},getTimeOverlappingItems(t,e,r){return t.filter(t=>this.doesTimeOverlap(t,e,r))},getSpaceOverlappingItems(t,e){return t.filter(t=>{if(s.contains(e,t))return!1;for(let r=0,i=e.length;r<i;r++)if(this.doesSpaceOverlap(t,e[r]))return!0;return!1})},onSeeking({t1:t,t2:e}){let{items:r,background:i}=this.props.store.getCurrentPage();if(e>t)r=this.getTimeOverlappingItems(r,t,e),this.renderItems(r);else{const n=this.getTimeOverlappingItems(r,e,t).filter(t=>t.begintime>e);this.ctx.fillStyle=i,n.forEach(t=>this.removeItem(t,i)),this.seekToPreviousPanPosition(n),r=(r=this.getSpaceOverlappingItems(r,n)).filter(({begintime:t})=>t<e),this.renderItems(r)}},seekToPreviousPanPosition(t){for(var e=0;e<t.length;e++){const r=t[e];if("pan"===r.type){const t=this.props.store.getPreviousPanItem(r);null!==t?this.renderPan(t):this.resetPan();break}}},_renderPan(t){"function"==typeof this.renderPan&&this.renderPan(t)}};return{getHighlightColor:function(t){return h(t)},getWallflowerColor:function(t){return function(t,e){const[r,i,n]=o(t),[a,s,h]=o(e);return"#"+[(r+a)/2,(i+s)/2,(n+h)/2].map(t=>Math.round(t)).map(t=>t.toString(16)).join("")}(h(t),"#ffffff")},CanvasMixin:l,mixinCanvas:function(t){Object.keys(l).forEach(e=>{void 0===t[e]&&(t[e]=l[e])})},ItemSearch:class{constructor(t,e,r){this.items=t,this.widthScale=e,this.heightScale=r}searchSquare(t,{item:e,x:r,y:i,ws:n,hs:a}){let{x1:s,y1:o,x2:h,y2:l}=e;h<s&&([s,h]=[h,s]),l<o&&([o,l]=[l,o]);const[u,c,f,d]=[s*n,o*a,h*n,l*a];r>=u&&r<=f&&i>=c&&i<=d&&t.push(e)}searchItems(t,e,r){let i=[];const n=this.widthScale,a=this.heightScale;for(let s=0,o=t.length;s<o;s++){const o=t[s];switch(o.type){case"stroke":break;case"circle":{let{center:t,radius:s}=o;const[h,l]=t,[u,c,f,d]=[h-s,h+s,l-s,l+s],[p,g,y,v]=[u*n,f*a,c*n,d*a];e>=p&&e<=y&&r>=g&&r<=v&&i.push(o)}break;case"ellipse":{const{radiusX:t,radiusY:s}=o,h=o.x,l=o.y,[u,c,f,d]=[h-t,h+t,l-s,l+s],[p,g,y,v]=[u*n,f*a,c*n,d*a];e>=p&&e<=y&&r>=g&&r<=v&&i.push(o)}break;case"rect":{let{x1:t,y1:s,x2:h,y2:l}=o;h<t&&([t,h]=[h,t]),l<s&&([s,l]=[l,s]);const[u,c,f,d]=[t*n,s*a,h*n,l*a];e>=u&&e<=f&&r>=c&&r<=d&&i.push(o)}break;case"square":this.searchSquare(i,{x:e,y:r,item:o,ws:n,hs:a});break;case"grid":{const{rows:t,cols:s,x1:h,y1:l,cellWidth:u,cellHeight:c}=o,f=h+u*s,d=l+c*t,[p,g,y,v]=[h*n,l*a,f*n,d*a];e>=p&&e<=y&&r>=g&&r<=v&&i.push(o)}break;case"image":{const{left:t,top:s,width:h,height:l}=o,[u,c,f,d]=[t,t+h,s,s+l],[p,g,y,v]=[u*n,f*a,c*n,d*a];e>=p&&e<=y&&r>=g&&r<=v&&i.push(o)}break;case"text":{const{left:t,top:s,fontsize:h,width:l,lines:u}=o,[c,f,d,p]=[t,t+l,s,s+h*u],[g,y,v,m]=[c*n,d*a,f*n,p*a];e>=g&&e<=v&&r>=y&&r<=m&&i.push(o)}break;case"math":{const{tex:t,left:s,top:h,fontsize:l}=o,u=t.length*l,c=1.5*l,[f,d,p,g]=[s,s+u,h,h+c],[y,v,m,b]=[f*n,p*a,d*n,g*a];e>=y&&e<=m&&r>=v&&r<=b&&i.push(o)}break;case"frozenItem":{const t=o.items,n=this.searchItems(t,e,r);i=i.concat(n)}break;case"line":case"pan":case"caption":case"still":break;default:console.assert(!1)}}return i}search(t,e){return this.searchItems(this.items,t,e)}}}}.call(e,r,e,t))||(t.exports=i)}])});