define(["base/js/namespace","base/js/events","nbextensions/thodio_player_extension/thodio-player","nbextensions/thodio_player_extension/pako_inflate.min"],function(e,t,n,o){return{load_ipython_extension:function(){function i(e){let t=Object.assign(e),n=function(e){let t=e.pages,n=[],o=0;for(let e=0;e<t.length;e++){let i=t[e],a=i.items;a=s(a);let d=Object.assign(i);n.push(d),d.items=[],d.data=d.items;let r,c=0,p=Object.assign(i.captions),m=Object.keys(p).map(e=>parseFloat(e)).sort(),u={};for(let e=0,t=a.length;e<t;e++)"stroke"===(r=Object.assign(a[e])).type&&l(r),m.forEach(e=>{if(e<=r.begintime&&!u[e]){let{text:t,color:n,duration:i}=p[e];void 0===i&&(i=2e3);let s={type:"caption",begintime:e+o,endtime:e+i+o,id:c++,text:t,color:n};d.items.push(s),u[e]=!0}}),r.begintime+=o,r.endtime+=o,r.id=c++,d.items.push(r);m.forEach(e=>{const{text:t,color:n}=p[e];!0!==u[e]&&(r={type:"caption",begintime:e+o,endtime:e+2e3+o,id:c++,text:t,color:n},d.items.push(r),u[e]=!0)}),i.begintime+=o,i.endtime=void 0!==r?r.endtime:i.begintime,o=i.endtime}return n}(t);t.pages=n;let o=t.pages.length,i=t.pages[o-1];return t.meta.duration=i.endtime,t}function s(e){const t=e.length;if(0===t)return[];const n=[];let o=0;for(;o<t-1;o++){const t=e[o],i=e[o+1];"pan"===t.type&&"pan"===i.type||n.push(t)}return n.push(e[o]),n}function l(e){if(e.points&&e.points.length>0){var t={x:e.points[0][1],y:e.points[0][2]},n={x:e.points[0][1],y:e.points[0][2]};e.points.forEach(function(o,i,s){var l,a,d={x:o[1],y:o[2]},r=(a=d,{x:((l=t).x+a.x)/2,y:(l.y+a.y)/2});e.points[i].push({prev_midpoint:n,prev_point:t,current_midpoint:r}),n=r,t=d})}return e}console.log("Inside thodio player Jupyter extension main page");var a=(e,t)=>{fetch(e+".json.gz").then(e=>{if(e.ok)return e.blob()}).then(e=>{var n,i=new FileReader;i.onload=function(){n=this.result;let e=o.ungzip(new Uint8Array(n),{to:"string"}),i=JSON.parse(e);console.log(i),t(i)},i.readAsArrayBuffer(e)})};function d(e){var t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,t.style.position="fixed",t.style.width="27%",t.style.height="300px",n.drawImage(e,0,0),e.style.display="none",t}function r(e){let t=document.getElementById("preview-div");$(".selected .cm-variable"),$(".input"),e.input[0].textContent.includes("geometry.")&&setTimeout(function(){let e=document.getElementsByClassName("geometry_canvas");t.innerHTML="";let n=document.createElement("canvas");var o,i;t.appendChild(n),o=n,i=e[0],o.replaceWith(d(i)),i.style.display="none"},200)}function c(){e.notebook.get_cells().forEach(function(e){"code"===e.cell_type&&e.input[0].textContent.includes("Canvas()")&&(function(){console.log("\n\nSplitting Jupyter screen");let e=document.createElement("div");e.classList.add("container");let t=document.getElementById("notebook-container");t.style.width="75%",t.style.float="left",t.classList.remove("container");let n=document.createElement("div");n.style.width="10%",n.style.float="left",n.style.backgroundColor="#FFFFFF",n.style.padding="15px";let o=document.createElement("div");o.setAttribute("id","preview-div"),n.appendChild(o),e.appendChild(t),e.appendChild(n);let i=document.getElementById("notebook");i.replaceChild(e,i.childNodes[0]),window.jupyterScreenSplit=!0}(),r(e))})}window.displayThodio=function(e){var t=$("div:contains("+e+")").closest(".cell");let n=document.getElementsByClassName("fa-circle-o-notch")[0];n&&n.classList.remove("hide-element"),a(e,n=>{var o=$("<div>");$(t[0]).append(o),o.attr("id",n.meta.title),m({rootEl:o[0],data:i(n),audio:e+".mp3"})})},t.on("execute.CodeCell",function(e,t){r(t.cell)});var p,m=n.renderPlayer;p="./nbextensions/thodio_player_extension/thodio-player.css",$("<link/>").attr({type:"text/css",rel:"stylesheet",href:require.toUrl(p)}).appendTo("head"),function(e,t){var n=document.createElement("script");n.onload=t,n.src=require.toUrl(e),document.head.appendChild(n)}("https://sdk.amazonaws.com/js/aws-sdk-2.154.0.min.js",function(){!function(){let e=document.getElementsByClassName("geometry_canvas")[0];e&&(e.style.display="none")}(),c(),function(){document.getElementById("notebook");let e=document.getElementById("notebook-container");window.jupyterScreenSplit||(e.style.paddingLeft="160px"),console.log("document viewport width",document.documentElement.clientWidth)}()})}}});
